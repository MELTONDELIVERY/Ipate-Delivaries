<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - IPATE Deliveries</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .loading { display: none; }
        .error { color: red; display: none; }
    </style>
</head>
<body class="min-h-screen bg-[#F8F9FA] flex items-center justify-center">
    <div class="bg-white rounded-xl shadow-lg p-8 max-w-md w-full">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-[#00B14F] flex items-center justify-center">
                <span class="mr-2">🚚</span>
                IPATE Deliveries
            </h1>
            <p class="text-gray-600 mt-2">Sign in to your account</p>
        </div>

        <div id="errorMessage" class="error bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
            <!-- Error messages will appear here -->
        </div>

        <form class="space-y-4" onsubmit="event.preventDefault(); handleLogin();">
            <div>
                <label class="block text-gray-700 mb-2">Email</label>
                <input type="email" id="email" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-[#00B14F]" required value="customer@example.com">
            </div>
            
            <div>
                <label class="block text-gray-700 mb-2">Password</label>
                <input type="password" id="password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-[#00B14F]" required value="password123">
            </div>

            <button type="submit" class="w-full bg-[#00B14F] text-white py-3 rounded-lg hover:bg-[#009640] transition-colors font-semibold">
                Sign In
                <span id="loadingSpinner" class="loading"> 🔄</span>
            </button>
        </form>

        <div class="text-center mt-6">
            <p class="text-gray-600">Don't have an account? 
                <a href="register.html" class="text-[#00B14F] hover:underline">Create Account</a>
            </p>
        </div>

        <div class="text-center mt-6">
            <a href="index.html" class="text-gray-500 hover:text-gray-700">← Back to Home</a>
        </div>
    </div>

    <!-- INLINE JAVASCRIPT - No external dependencies -->
    <script>
        console.log("🚀 SIMPLE VERSION: Starting...");

        // Simple mock data - defined inline
        const SimpleMockData = {
            users: [
                {
                    id: 'user001',
                    email: 'customer@example.com',
                    password: 'password123',
                    name: 'John Doe',
                    role: 'customer'
                },
                {
                    id: 'user002', 
                    email: 'seller@example.com',
                    password: 'password123',
                    name: 'Sarah\'s Kitchen',
                    role: 'seller'
                },
                {
                    id: 'user003',
                    email: 'rider@example.com', 
                    password: 'password123',
                    name: 'Michael Kimani',
                    role: 'rider'
                }
            ]
        };

        // Simple authentication
        const SimpleAuth = {
            currentUser: null,

            login: function(email, password) {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        const user = SimpleMockData.users.find(u => 
                            u.email === email && u.password === password
                        );
                        
                        if (user) {
                            // Remove password from response
                            const { password: _, ...userWithoutPassword } = user;
                            this.currentUser = userWithoutPassword;
                            localStorage.setItem('ipate_simple_user', JSON.stringify(userWithoutPassword));
                            resolve({ user: userWithoutPassword, error: null });
                        } else {
                            reject(new Error('Invalid email or password'));
                        }
                    }, 1000);
                });
            },

            isAuthenticated: function() {
                try {
                    const userData = localStorage.getItem('ipate_simple_user');
                    if (userData) {
                        this.currentUser = JSON.parse(userData);
                        return true;
                    }
                } catch (e) {
                    console.error('Error reading user data:', e);
                }
                return false;
            },

            redirectToDashboard: function() {
                if (!this.currentUser) return;
                
                const dashboards = {
                    'customer': 'customer.html',
                    'seller': 'seller.html',
                    'rider': 'rider.html'
                };
                
                const dashboard = dashboards[this.currentUser.role];
                if (dashboard) {
                    window.location.href = dashboard;
                }
            },

            showMessage: function(message, type = 'success') {
                const errorDiv = document.getElementById('errorMessage');
                if (errorDiv) {
                    errorDiv.textContent = message;
                    errorDiv.className = type === 'error' ? 
                        'error bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4' :
                        'error bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4';
                    errorDiv.style.display = 'block';
                    
                    // Auto-hide success messages
                    if (type === 'success') {
                        setTimeout(() => {
                            errorDiv.style.display = 'none';
                        }, 3000);
                    }
                } else {
                    alert(`${type.toUpperCase()}: ${message}`);
                }
            }
        };

        // Login handler
        async function handleLogin() {
            console.log("🚀 SIMPLE VERSION: Login attempt");
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const button = document.querySelector('button');
            const spinner = document.getElementById('loadingSpinner');
            
            // Hide any previous errors
            document.getElementById('errorMessage').style.display = 'none';
            
            if (!email || !password) {
                SimpleAuth.showMessage('Please enter both email and password', 'error');
                return;
            }

            // Show loading
            button.disabled = true;
            spinner.style.display = 'inline';

            try {
                const result = await SimpleAuth.login(email, password);
                SimpleAuth.showMessage('Login successful! Redirecting...', 'success');
                
                setTimeout(() => {
                    SimpleAuth.redirectToDashboard();
                }, 2000);
                
            } catch (error) {
                console.error('Login error:', error);
                SimpleAuth.showMessage(error.message, 'error');
            } finally {
                // Reset button
                button.disabled = false;
                spinner.style.display = 'none';
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log("🚀 SIMPLE VERSION: Page loaded");
            
            // Check if already logged in
            if (SimpleAuth.isAuthenticated()) {
                SimpleAuth.showMessage('You are already logged in. Redirecting...', 'success');
                setTimeout(() => {
                    SimpleAuth.redirectToDashboard();
                }, 1000);
            }
            
            // Test that JavaScript is working
            console.log("🚀 SIMPLE VERSION: JavaScript is working!");
            console.log("🚀 SIMPLE VERSION: Available users:", SimpleMockData.users.map(u => u.email));
        });

        // Global error handler
        window.addEventListener('error', function(e) {
            console.error('Global error:', e.error);
            SimpleAuth.showMessage('JavaScript error: ' + e.error, 'error');
        });
    </script>
</body>
</html>
